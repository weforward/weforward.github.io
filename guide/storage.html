<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>存储 | Weforward</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="一套开发分布式系统的支撑框架">
    
    <link rel="preload" href="/assets/css/0.styles.5b784d38.css" as="style"><link rel="preload" href="/assets/js/app.1513673d.js" as="script"><link rel="preload" href="/assets/js/2.6315147b.js" as="script"><link rel="preload" href="/assets/js/18.101806d3.js" as="script"><link rel="prefetch" href="/assets/js/10.e0c05130.js"><link rel="prefetch" href="/assets/js/11.f33d471d.js"><link rel="prefetch" href="/assets/js/12.5eb68afc.js"><link rel="prefetch" href="/assets/js/13.dbfb0dfe.js"><link rel="prefetch" href="/assets/js/14.34adc96b.js"><link rel="prefetch" href="/assets/js/15.716c9e31.js"><link rel="prefetch" href="/assets/js/16.20f00db5.js"><link rel="prefetch" href="/assets/js/17.e88dd035.js"><link rel="prefetch" href="/assets/js/3.1b760fd2.js"><link rel="prefetch" href="/assets/js/4.57a617eb.js"><link rel="prefetch" href="/assets/js/5.a864e608.js"><link rel="prefetch" href="/assets/js/6.ee006622.js"><link rel="prefetch" href="/assets/js/7.13dac9f7.js"><link rel="prefetch" href="/assets/js/8.fe520bd6.js"><link rel="prefetch" href="/assets/js/9.be7ed3cd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5b784d38.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Weforward</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/guide/" class="nav-link router-link-active">
  指南
</a></div><div class="nav-item"><a href="https://github.com/weforward" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/guide/" class="nav-link router-link-active">
  指南
</a></div><div class="nav-item"><a href="https://github.com/weforward" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>服务端</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/server.html" class="sidebar-link">快速开始</a></li><li><a href="/guide/service.html" class="sidebar-link">服务说明</a></li><li><a href="/guide/method.html" class="sidebar-link">方法说明</a></li><li><a href="/guide/access.html" class="sidebar-link">权限验证</a></li><li><a href="/guide/session.html" class="sidebar-link">会话</a></li><li><a href="/guide/resource.html" class="sidebar-link">资源</a></li><li><a href="/guide/forward.html" class="sidebar-link">转发</a></li><li><a href="/guide/storage.html" aria-current="page" class="active sidebar-link">存储</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/storage.html#引用项目" class="sidebar-link">引用项目</a></li><li class="sidebar-sub-header"><a href="/guide/storage.html#persister模块" class="sidebar-link">Persister模块</a></li><li class="sidebar-sub-header"><a href="/guide/storage.html#search模块" class="sidebar-link">search模块</a></li><li class="sidebar-sub-header"><a href="/guide/storage.html#array模块" class="sidebar-link">array模块</a></li><li class="sidebar-sub-header"><a href="/guide/storage.html#counter模块" class="sidebar-link">counter模块</a></li><li class="sidebar-sub-header"><a href="/guide/storage.html#数据映射方式" class="sidebar-link">数据映射方式</a></li><li class="sidebar-sub-header"><a href="/guide/storage.html#支持数据类型" class="sidebar-link">支持数据类型</a></li><li class="sidebar-sub-header"><a href="/guide/storage.html#自动拆装箱机制" class="sidebar-link">自动拆装箱机制</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>调用端</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/client.html" class="sidebar-link">TODO CLIENT</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>部署运维</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/operation.html" class="sidebar-link">TODO OPERATION</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="存储"><a href="#存储" class="header-anchor">#</a> 存储</h1> <p><a href="https://github.com/weforward/weforward-data" target="_blank" rel="noopener noreferrer">Weforward Data<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>项目提供一套存储的API，方便编程使用，目前主要有persister，search，array，counter，log几个模块。</p> <h2 id="引用项目"><a href="#引用项目" class="header-anchor">#</a> 引用项目</h2> <h3 id="maven方式引入"><a href="#maven方式引入" class="header-anchor">#</a> maven方式引入</h3> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.weforward<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>weforward-data<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="gradle方式的引入"><a href="#gradle方式的引入" class="header-anchor">#</a> gradle方式的引入</h3> <div class="language-groovy extra-class"><pre class="language-groovy"><code>dependencies <span class="token punctuation">{</span>
    compile <span class="token string">'cn.weforward:weforward-data:${version}'</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="persister模块"><a href="#persister模块" class="header-anchor">#</a> Persister模块</h2> <h3 id="功能"><a href="#功能" class="header-anchor">#</a> 功能</h3> <p>persister实现一套业务对象的持久化接口。用于支撑业务对象的查询，保存，删除功能。</p> <h3 id="使用方式"><a href="#使用方式" class="header-anchor">#</a> 使用方式</h3> <p>1.定义一个 di(dependency interface)和它的实现类</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">OrderDi</span> <span class="token keyword">extends</span> <span class="token class-name">BusinessDi</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderImpl</span> <span class="token keyword">implements</span> <span class="token class-name">OrderDi</span> <span class="token punctuation">{</span>

	<span class="token keyword">protected</span> <span class="token class-name">PersisterFactory</span> m_Factory<span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token class-name">OrderImpl</span><span class="token punctuation">(</span><span class="token class-name">PersisterFactory</span> factory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		m_Factory <span class="token operator">=</span> factory<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span> <span class="token keyword">extends</span> <span class="token class-name">Persistent</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Persister</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token function">getPersister</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> m_Factory<span class="token punctuation">.</span><span class="token function">getPersister</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>di需要继承BusinessDi接口</p></blockquote> <p>2.定义业务对象</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Order</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractPersistent</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderDi</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Resource</span>
	<span class="token keyword">protected</span> <span class="token keyword">int</span> m_Amount<span class="token punctuation">;</span>

	<span class="token keyword">protected</span> <span class="token class-name">Order</span><span class="token punctuation">(</span><span class="token class-name">OrderDi</span> di<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">(</span>di<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//反射对象用的不能删除</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">Order</span><span class="token punctuation">(</span><span class="token class-name">OrderDi</span> di<span class="token punctuation">,</span> <span class="token keyword">int</span> amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">(</span>di<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建对象的方法</span>
		<span class="token function">genPersistenceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 生成id</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// TODO</span>
		<span class="token function">markPersistenceUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//标记保存对象</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>3.定义服务并创建持久器</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderService</span> <span class="token keyword">extends</span> <span class="token class-name">OrderDiImpl</span> <span class="token punctuation">{</span>

	<span class="token keyword">protected</span> <span class="token class-name">Persister</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Order</span><span class="token punctuation">&gt;</span></span> m_PsOrder<span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token class-name">OrderService</span><span class="token punctuation">(</span><span class="token class-name">PersisterFactory</span> factory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span><span class="token punctuation">;</span>
		m_PsOrder <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">createPersister</span><span class="token punctuation">(</span><span class="token class-name">Order</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">Order</span> <span class="token function">getOrder</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> m_PsOrder<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">Order</span> <span class="token function">createOrder</span><span class="token punctuation">(</span><span class="token keyword">int</span> amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Order</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>Data模块没有PersisterFactory的具体实现，需参考<a href="https://github.com/weforward/weforward-data-mongodb" target="_blank" rel="noopener noreferrer">Weforward Data Mongodb<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>实现</p></blockquote> <p>4.条件搜索</p> <p>Persister提供一定的条件搜索支撑</p> <p>单一比较的条件</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//相等</span>
ps<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token class-name">ConditionUtil</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">ConditionUtil</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;HelloWorld&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//不相等</span>
ps<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token class-name">ConditionUtil</span><span class="token punctuation">.</span><span class="token function">ne</span><span class="token punctuation">(</span><span class="token class-name">ConditionUtil</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;HelloWorld&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//小于</span>
ps<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token class-name">ConditionUtil</span><span class="token punctuation">.</span><span class="token function">lt</span><span class="token punctuation">(</span><span class="token class-name">ConditionUtil</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;date&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;20200808&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//大于</span>
ps<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token class-name">ConditionUtil</span><span class="token punctuation">.</span><span class="token function">gt</span><span class="token punctuation">(</span><span class="token class-name">ConditionUtil</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;date&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;20200808&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//小于等于</span>
ps<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token class-name">ConditionUtil</span><span class="token punctuation">.</span><span class="token function">lte</span><span class="token punctuation">(</span><span class="token class-name">ConditionUtil</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;date&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;20200808&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//大于等于</span>
ps<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token class-name">ConditionUtil</span><span class="token punctuation">.</span><span class="token function">gte</span><span class="token punctuation">(</span><span class="token class-name">ConditionUtil</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;date&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;20200808&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>范围查询条件</p> <div class="language-java extra-class"><pre class="language-java"><code>ps<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token class-name">ConditionUtil</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token class-name">ConditionUtil</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;20200808&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;202008089&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>与条件查询(全匹配)</p> <div class="language-java extra-class"><pre class="language-java"><code>ps<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token class-name">ConditionUtil</span><span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token class-name">ConditionUtil</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">ConditionUtil</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;HelloWorld&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				<span class="token class-name">ConditionUtil</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">ConditionUtil</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;20200808&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>或条件查询(有一个匹配)</p> <div class="language-java extra-class"><pre class="language-java"><code>ps<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token class-name">ConditionUtil</span><span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span><span class="token class-name">ConditionUtil</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">ConditionUtil</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;HelloWorld&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				<span class="token class-name">ConditionUtil</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">ConditionUtil</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;20200808&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面举例的属性者是持久类的基本属性的查询，有一种情况，我们需要根据持久类的属性对象(如VO类)里面的属性查询，这时的处理如下</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Order</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractPersistent</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderDi</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Resource</span>
	<span class="token keyword">protected</span> <span class="token class-name">Vo</span> m_Vo<span class="token punctuation">;</span>

	<span class="token keyword">protected</span> <span class="token class-name">Order</span><span class="token punctuation">(</span><span class="token class-name">OrderDi</span> di<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">(</span>di<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//反射对象用的不能删除</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Vo</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Resource</span>
	<span class="token keyword">protected</span> <span class="token class-name">String</span> m_Name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

ps<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token class-name">ConditionUtil</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">ConditionUtil</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;m_Vo&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;m_Name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;HelloWorld&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>5.建立索引</p> <p>条件搜索理论上支持持久类的所有属性，但是直接按这些属性条件搜索可以效率会比较低，所以我们需要对经常用来查询的属性建立索引</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Order</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractPersistent</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderDi</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Resource</span>
	<span class="token keyword">protected</span> <span class="token class-name">Vo</span> m_Vo<span class="token punctuation">;</span>

	<span class="token keyword">protected</span> <span class="token class-name">Order</span><span class="token punctuation">(</span><span class="token class-name">OrderDi</span> di<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">(</span>di<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//反射对象用的不能删除</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Vo</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Index</span> <span class="token comment">//标记索引 </span>
	<span class="token annotation punctuation">@Resource</span>
	<span class="token keyword">protected</span> <span class="token class-name">String</span> m_Name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>有一点需要注意的是索引只会自己建议，不会自己删除，如在A上加个索引@Index，之后又将A的索引@Index去掉，些时需要人工登陆数据库将对应索引删除。</p> <p>6.排序</p> <p>条件查询的同时，指定排序</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 正序</span>
ps<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token class-name">ConditionUtil</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">ConditionUtil</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;HelloWorld&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">OrderByUtil</span><span class="token punctuation">.</span><span class="token function">asc</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 倒序</span>
ps<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token class-name">ConditionUtil</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">ConditionUtil</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;HelloWorld&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">OrderByUtil</span><span class="token punctuation">.</span><span class="token function">desc</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 混合</span>
ps<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token class-name">ConditionUtil</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">ConditionUtil</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;HelloWorld&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				<span class="token class-name">OrderByUtil</span><span class="token punctuation">.</span><span class="token function">unite</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;date&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="search模块"><a href="#search模块" class="header-anchor">#</a> search模块</h2> <h3 id="功能-2"><a href="#功能-2" class="header-anchor">#</a> 功能</h3> <p>search提供关键字搜索的功能，通过建立索引支撑各种关键字搜索</p> <h3 id="使用方式-2"><a href="#使用方式-2" class="header-anchor">#</a> 使用方式</h3> <p>1.通过工厂创建搜索器</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Searcher</span> searcher <span class="token operator">=</span> m_Factory<span class="token punctuation">.</span><span class="token function">createSearcher</span><span class="token punctuation">(</span><span class="token string">&quot;order_doc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>TIP: Data模块没有SearchFactory的具体实现，需参考<a href="https://github.com/weforward/weforward-data-mongodb" target="_blank" rel="noopener noreferrer">Weforward Data Mongodb<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>实现</p> <p>2.创建索引</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">IndexKeyword</span><span class="token punctuation">&gt;</span></span> keywords <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
keywords<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">IndexKeywordHelper</span><span class="token punctuation">.</span><span class="token function">newKeyword</span><span class="token punctuation">(</span><span class="token string">&quot;小额&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
keywords<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">IndexKeywordHelper</span><span class="token punctuation">.</span><span class="token function">newKeyword</span><span class="token punctuation">(</span><span class="token string">&quot;汽车&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
keywords<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">IndexKeywordHelper</span><span class="token punctuation">.</span><span class="token function">newKeyword</span><span class="token punctuation">(</span><span class="token string">&quot;D:20200524&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
searcher<span class="token punctuation">.</span><span class="token function">updateElement</span><span class="token punctuation">(</span><span class="token class-name">IndexElementHelper</span><span class="token punctuation">.</span><span class="token function">newElement</span><span class="token punctuation">(</span><span class="token string">&quot;Order$123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> keywords<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>3.单关键字匹配</p> <div class="language-java extra-class"><pre class="language-java"><code>searcher<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;汽车&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>4.多关键字匹配</p> <div class="language-java extra-class"><pre class="language-java"><code>searcher<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;小额&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;汽车&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 与关系</span>
</code></pre></div><p>5.任意关键字匹配</p> <div class="language-java extra-class"><pre class="language-java"><code>searcher<span class="token punctuation">.</span><span class="token function">union</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;小额&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;汽车&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 或关系</span>
</code></pre></div><p>6.范围匹配</p> <div class="language-java extra-class"><pre class="language-java"><code>searcher<span class="token punctuation">.</span><span class="token function">searchRange</span><span class="token punctuation">(</span><span class="token string">&quot;D:20200524&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;D:202005249&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 加上属性前端(如D:)后可精确匹配到属性</span>
</code></pre></div><p>7.匹配率排序</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//updateElement时指定匹配率</span>
searcher<span class="token punctuation">.</span><span class="token function">updateElement</span><span class="token punctuation">(</span><span class="token class-name">IndexElementHelper</span><span class="token punctuation">.</span><span class="token function">newElement</span><span class="token punctuation">(</span><span class="token class-name">UniteId</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token string">&quot;Order$1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				<span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token class-name">IndexKeywordHelper</span><span class="token punctuation">.</span><span class="token function">newKeyword</span><span class="token punctuation">(</span><span class="token string">&quot;我们的&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
searcher<span class="token punctuation">.</span><span class="token function">updateElement</span><span class="token punctuation">(</span><span class="token class-name">IndexElementHelper</span><span class="token punctuation">.</span><span class="token function">newElement</span><span class="token punctuation">(</span><span class="token class-name">UniteId</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token string">&quot;Order$2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				<span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token class-name">IndexKeywordHelper</span><span class="token punctuation">.</span><span class="token function">newKeyword</span><span class="token punctuation">(</span><span class="token string">&quot;我们的&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">IndexResults</span> irs <span class="token operator">=</span> searcher<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token class-name">SearchOption</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token class-name">SearchOption</span><span class="token punctuation">.</span>OPTION_RATE_SORT<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;我们的&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//结果为order2，order1的顺序</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">IndexResult</span> ir <span class="token operator">:</span> <span class="token class-name">ResultPageHelper</span><span class="token punctuation">.</span><span class="token function">toForeach</span><span class="token punctuation">(</span>irs<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ir<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>8.匹配率过滤</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//updateElement时指定匹配率	</span>
searcher<span class="token punctuation">.</span><span class="token function">updateElement</span><span class="token punctuation">(</span><span class="token class-name">IndexElementHelper</span><span class="token punctuation">.</span><span class="token function">newElement</span><span class="token punctuation">(</span><span class="token class-name">UniteId</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token string">&quot;Order$1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				<span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token class-name">IndexKeywordHelper</span><span class="token punctuation">.</span><span class="token function">newKeyword</span><span class="token punctuation">(</span><span class="token string">&quot;我们的&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
searcher<span class="token punctuation">.</span><span class="token function">updateElement</span><span class="token punctuation">(</span><span class="token class-name">IndexElementHelper</span><span class="token punctuation">.</span><span class="token function">newElement</span><span class="token punctuation">(</span><span class="token class-name">UniteId</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token string">&quot;Order$2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				<span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token class-name">IndexKeywordHelper</span><span class="token punctuation">.</span><span class="token function">newKeyword</span><span class="token punctuation">(</span><span class="token string">&quot;我们的&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
searcher<span class="token punctuation">.</span><span class="token function">updateElement</span><span class="token punctuation">(</span><span class="token class-name">IndexElementHelper</span><span class="token punctuation">.</span><span class="token function">newElement</span><span class="token punctuation">(</span><span class="token class-name">UniteId</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token string">&quot;Order$3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				<span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token class-name">IndexKeywordHelper</span><span class="token punctuation">.</span><span class="token function">newKeyword</span><span class="token punctuation">(</span><span class="token string">&quot;我们的&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//通过OPTION_RATE_LEAST指定至少匹配	</span>
<span class="token class-name">IndexResults</span> irs <span class="token operator">=</span> searcher<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token class-name">SearchOption</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token class-name">SearchOption</span><span class="token punctuation">.</span>OPTION_RATE_LEAST<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setRate</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;我们的&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 结果为order2,order3</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">IndexResult</span> ir <span class="token operator">:</span> <span class="token class-name">ResultPageHelper</span><span class="token punctuation">.</span><span class="token function">toForeach</span><span class="token punctuation">(</span>irs<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> ir<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>也可按范围过滤</p> <div class="language-java extra-class"><pre class="language-java"><code>			
<span class="token class-name">IndexResults</span>	irs <span class="token operator">=</span> searcher<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token class-name">SearchOption</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token class-name">SearchOption</span><span class="token punctuation">.</span>OPTION_RATE_RANGE<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setStartRate</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setEndRate</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;我们的&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 结果为order1,order2</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">IndexResult</span> ir <span class="token operator">:</span> <span class="token class-name">ResultPageHelper</span><span class="token punctuation">.</span><span class="token function">toForeach</span><span class="token punctuation">(</span>irs<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> ir<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>9.按属性排序</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//updataElement时指定属性</span>
searcher<span class="token punctuation">.</span><span class="token function">updateElement</span><span class="token punctuation">(</span>
				<span class="token class-name">IndexElementHelper</span><span class="token punctuation">.</span><span class="token function">newElement</span><span class="token punctuation">(</span><span class="token class-name">UniteId</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token string">&quot;Order$1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
						<span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token class-name">IndexAttributeHelper</span><span class="token punctuation">.</span><span class="token function">newAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				<span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token class-name">IndexKeywordHelper</span><span class="token punctuation">.</span><span class="token function">newKeyword</span><span class="token punctuation">(</span><span class="token string">&quot;我们的&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
searcher<span class="token punctuation">.</span><span class="token function">updateElement</span><span class="token punctuation">(</span>
				<span class="token class-name">IndexElementHelper</span><span class="token punctuation">.</span><span class="token function">newElement</span><span class="token punctuation">(</span><span class="token class-name">UniteId</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token string">&quot;Order$2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
						<span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token class-name">IndexAttributeHelper</span><span class="token punctuation">.</span><span class="token function">newAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				<span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token class-name">IndexKeywordHelper</span><span class="token punctuation">.</span><span class="token function">newKeyword</span><span class="token punctuation">(</span><span class="token string">&quot;我们的&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
searcher<span class="token punctuation">.</span><span class="token function">updateElement</span><span class="token punctuation">(</span>
				<span class="token class-name">IndexElementHelper</span><span class="token punctuation">.</span><span class="token function">newElement</span><span class="token punctuation">(</span><span class="token class-name">UniteId</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token string">&quot;Order$3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
						<span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token class-name">IndexAttributeHelper</span><span class="token punctuation">.</span><span class="token function">newAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				<span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token class-name">IndexKeywordHelper</span><span class="token punctuation">.</span><span class="token function">newKeyword</span><span class="token punctuation">(</span><span class="token string">&quot;我们的&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">IndexResults</span> irs <span class="token operator">=</span> searcher<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;我们的&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
irs<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">,</span> <span class="token class-name">IndexResults</span><span class="token punctuation">.</span>OPTION_ORDER_BY_DESC<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 结果为order3，order2，order1的顺序</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">IndexResult</span> ir <span class="token operator">:</span> <span class="token class-name">ResultPageHelper</span><span class="token punctuation">.</span><span class="token function">toForeach</span><span class="token punctuation">(</span>irs<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;场景7:&quot;</span> <span class="token operator">+</span> ir<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="array模块"><a href="#array模块" class="header-anchor">#</a> array模块</h2> <h3 id="功能-3"><a href="#功能-3" class="header-anchor">#</a> 功能</h3> <p>array模块用于归档存储同一类数据，与数据库的结构对照大概为</p> <ul><li>LabelSet 	 =&gt; db(数据库)</li> <li>Label    	 =&gt; table(表)</li> <li>LabelElement =&gt; row(行)</li></ul> <h3 id="使用方式-3"><a href="#使用方式-3" class="header-anchor">#</a> 使用方式</h3> <p>1.实现LabelElement</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyLabel</span> <span class="token keyword">implements</span> <span class="token class-name">LabelElement</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Resource</span>
	<span class="token keyword">protected</span> <span class="token class-name">String</span> m_Id<span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Resource</span>
	<span class="token keyword">protected</span> <span class="token class-name">String</span> m_Name<span class="token punctuation">;</span>

	<span class="token keyword">protected</span> <span class="token class-name">MyLabel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 反射使用</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">MyLabel</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		m_Id <span class="token operator">=</span> id<span class="token punctuation">;</span>
		m_Name <span class="token operator">=</span> name<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getIdForLabel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> m_Id<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>2.通过工厂创建标签集合</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">LabelSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MyLabel</span><span class="token punctuation">&gt;</span></span> myLabel <span class="token operator">=</span> m_Factory<span class="token punctuation">.</span><span class="token function">createLabelSet</span><span class="token punctuation">(</span><span class="token string">&quot;mylabel&quot;</span><span class="token punctuation">,</span> <span class="token class-name">FieldMapper</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token class-name">MyLabel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>Data模块没有LabelSetFactory的具体实现，需参考<a href="https://github.com/weforward/weforward-data-mongodb" target="_blank" rel="noopener noreferrer">Weforward Data Mongodb<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>实现</p></blockquote> <p>3.保存标签</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> label <span class="token operator">=</span> <span class="token string">&quot;one&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">MyLabel</span> l <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyLabel</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;HelloWorld!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myLabel<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>label<span class="token punctuation">,</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
label <span class="token operator">=</span> <span class="token string">&quot;two&quot;</span><span class="token punctuation">;</span>
l <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyLabel</span><span class="token punctuation">(</span><span class="token string">&quot;231&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;HelloWorld!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myLabel<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>label<span class="token punctuation">,</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>4.获取标签</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">MyLabel</span> l<span class="token operator">=</span>	myLabel<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;one&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="counter模块"><a href="#counter模块" class="header-anchor">#</a> counter模块</h2> <h3 id="功能-4"><a href="#功能-4" class="header-anchor">#</a> 功能</h3> <p>counter实现一个计数功能，通过KEY-VALUE方法保存一个关键字对应的数值，可用于人数统计，金额汇总等场景</p> <h3 id="使用方法"><a href="#使用方法" class="header-anchor">#</a> 使用方法</h3> <p>1.通过工厂创建计数器</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/** x00ff为服务器的标识，无固定格式，保证每一台服务器唯一即可*/</span>
<span class="token class-name">LabelCounterFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LabelCounterFactory</span><span class="token punctuation">(</span>labelSetFactory<span class="token punctuation">,</span> <span class="token string">&quot;x00ff&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Counter</span> counter <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">createCounter</span><span class="token punctuation">(</span><span class="token string">&quot;order&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>Data模块指定依赖LabelSetFactory的CounterFactory实现，如果有需要也可自行实现一个CounterFactory</p></blockquote> <p>2.计数</p> <div class="language-java extra-class"><pre class="language-java"><code>counter<span class="token punctuation">.</span><span class="token function">inc</span><span class="token punctuation">(</span><span class="token string">&quot;Order$123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>3.获取值</p> <div class="language-java extra-class"><pre class="language-java"><code>counter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;Order$123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="数据映射方式"><a href="#数据映射方式" class="header-anchor">#</a> 数据映射方式</h2> <p>数据存储通过ObjectMapper实现对象对存储数据的转换，除了自己实现一个ObjectMapper的方式，Weforward Data还提供了两种自动映射方式</p> <h3 id="属性映射"><a href="#属性映射" class="header-anchor">#</a> 属性映射</h3> <p>实现类为FieldMapper</p> <p>1.使用规则</p> <p>属性映射通过在类属性增加@Resource或@ResourceExt注释需要转换保存数据</p> <blockquote><p>基础类型使用@Resource即可,@ResourceExt用于集合等特殊类型</p></blockquote> <p>默认情况下只解析当前类的属性，如果需要保存父类属性，需要有当前类加上@Inherited</p> <p>2.指定方式</p> <p>persister</p> <p>继承了AbstractPersisterFactory类的PersisterFactory实现默认使用属性映射
也可通过setMapperType(&quot;field&quot;)强制指定</p> <p>array</p> <p>通过在创建LabelSetHub时指定</p> <div class="language-java extra-class"><pre class="language-java"><code>m_Factory<span class="token punctuation">.</span><span class="token function">createLabelSet</span><span class="token punctuation">(</span><span class="token string">&quot;mylabel&quot;</span><span class="token punctuation">,</span> <span class="token class-name">FieldMapper</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token class-name">MyLabel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="方法映射"><a href="#方法映射" class="header-anchor">#</a> 方法映射</h3> <p>实现类为MethodMapper</p> <p>1.使用规则</p> <p>方法映射通过解析类的get和set方法映射，默认解析所有get和set方法（包括父类getClass()除外）</p> <p>如果不想映射指定方法，可使用@Transient注释方法</p> <ul><li>get方法标准：非静态，方法可见性public，返回类型不为void，没有入参。如：public String getName()</li> <li>set方法标准：非静态，方法可见性public，返回类型为void，有且只有一个入参。如：public void setName(String name)</li></ul> <p>另外方法同样可以使用@Resource和@Resource注解</p> <p>2.指定方式</p> <p>persister</p> <p>继承了AbstractPersisterFactory类可通过setMapperType(&quot;method&quot;)指定</p> <p>array</p> <p>通过在创建LabelSetHub时指定</p> <div class="language-java extra-class"><pre class="language-java"><code>m_Factory<span class="token punctuation">.</span><span class="token function">createLabelSet</span><span class="token punctuation">(</span><span class="token string">&quot;mylabel&quot;</span><span class="token punctuation">,</span> <span class="token class-name">MethodMapper</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token class-name">MyLabel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="支持数据类型"><a href="#支持数据类型" class="header-anchor">#</a> 支持数据类型</h2> <p>=== 基础类型</p> <table><thead><tr><th>类型</th> <th>默认值</th></tr></thead> <tbody><tr><td>byte</td> <td>0</td></tr> <tr><td>short</td> <td>0</td></tr> <tr><td>int</td> <td>0</td></tr> <tr><td>long</td> <td>0</td></tr> <tr><td>float</td> <td>0</td></tr> <tr><td>double</td> <td>0</td></tr> <tr><td>boolean</td> <td>false</td></tr> <tr><td>Byte</td> <td>null</td></tr> <tr><td>Short</td> <td>null</td></tr> <tr><td>Integer</td> <td>null</td></tr> <tr><td>Long</td> <td>null</td></tr> <tr><td>Float</td> <td>null</td></tr> <tr><td>Double</td> <td>null</td></tr> <tr><td>Boolean</td> <td>null</td></tr> <tr><td>String</td> <td>null</td></tr> <tr><td>java.math.BigInteger</td> <td>null</td></tr> <tr><td>java.math.BigDecimal</td> <td>null</td></tr></tbody></table> <ul><li>属性映射方式下，使用@Resource注解即可</li> <li>方法映射方式下，不需要注解</li></ul> <h3 id="日期"><a href="#日期" class="header-anchor">#</a> 日期</h3> <p>java.util.Date类</p> <ul><li>属性映射方式下，使用@Resource注解即可</li> <li>方法映射方式下，不需要注解</li></ul> <h3 id="数组"><a href="#数组" class="header-anchor">#</a> 数组</h3> <p>数组元素可以是基础类型或者VO，支持多维数组</p> <ul><li>属性映射方式下，使用@Resource注解即可</li> <li>方法映射方式下，不需要注解</li></ul> <h3 id="集合"><a href="#集合" class="header-anchor">#</a> 集合</h3> <p>属性或方法的类型可以为以下类</p> <ul><li>java.util.Collection</li> <li>java.util.AbstractCollection</li> <li>java.util.List</li> <li>java.util.AbstractList</li> <li>java.util.ArrayList</li> <li>java.util.set</li> <li>java.util.AbstractList</li> <li>java.util.HashSet</li></ul> <p>Collection、AbstractCollection、List与AbstractList反射后的实现类为ArrayList</p> <p>Set与AbstractSet反射后的实现类为HashSet</p> <p>当元素是基础类型或者VO</p> <ul><li>属性映射方式下，使用@ResourceExt(component = xxx.class)指定元素类型</li> <li>方法映射方式下，不需要注解</li></ul> <p>当元素的集合又是一个集合时，不管是哪种映射方式，都需要使用ResourceExt注解，并且指定@ResourceExt(components ={ component1.class,component2.class ... componentx.class })</p> <p>如:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ResourceExt</span><span class="token punctuation">(</span>components <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token class-name">List</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> myListList<span class="token punctuation">;</span>

<span class="token annotation punctuation">@ResourceExt</span><span class="token punctuation">(</span>components <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token class-name">List</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">getMyListList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre></div><h3 id="地图"><a href="#地图" class="header-anchor">#</a> 地图</h3> <p>属性或方法的类型可以为以下类</p> <ul><li>java.util.Map</li> <li>java.util.AbstractMap</li> <li>java.util.HashMap</li> <li>java.util.ConcurrentMap</li> <li>java.util.ConcurrentHashMap</li></ul> <p>Map、AbstractMap反射后的实现类为HashMap</p> <p>ConcurrentMap反射后的实现类为ConcurrentHashMap</p> <p>当Map的Key和Value都基础类型或者VO</p> <ul><li>属性映射方式下，使用@ResourceExt(components ={ key.class,value.class})指定元素类型</li> <li>方法映射方式下，使用@ResourceExt(components ={ key.class,value.class})指定元素类型</li></ul> <p>当Value为集合时，可在components 指定下级组件类型。
如:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ResourceExt</span><span class="token punctuation">(</span>components <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Date</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Date</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> myMapList<span class="token punctuation">;</span>

<span class="token annotation punctuation">@ResourceExt</span><span class="token punctuation">(</span>components <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Date</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Date</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">getMyMapList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>key只能是基础类型或VO</p></blockquote> <h3 id="值对象-vo"><a href="#值对象-vo" class="header-anchor">#</a> 值对象（VO）</h3> <p>当数据类型非以上说明的几种类型时，均视为值对象(VO)</p> <p>VO需要有一个入参为空的构造函数，属性或方法参数可以为所有支持数据类型。</p> <ul><li>属性映射方式下，使用@Resource注释VO,同时VO里面的属性也需要使用@Resource或@ResourceExt注释。</li> <li>方法映射方式下，不需要注解，会根据VO里面的get和set方法映射。</li></ul> <h2 id="自动拆装箱机制"><a href="#自动拆装箱机制" class="header-anchor">#</a> 自动拆装箱机制</h2> <p>有时候我们为了编程方便定义了一些封装对象，但保存数据时又只需要保存简单的数据类型。
这种时间就适合使用自动拆装箱机制。</p> <blockquote><p>属性映射和方法映射启动自动拆装箱机制相同</p></blockquote> <p>要启动自动拆装箱机制非常容易，只需要在@Resource或@ResourceExt注解时同时指定type即可</p> <p>如：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Resource</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">UniteId</span> myId<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Resource</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">UniteId</span> <span class="token function">getMyId</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>拆箱规则：调用源对象的XXXValue方法转换成目标对象，如上面代码会调用 myId.stringValue()方法</li> <li>装箱规则：调用目标对象的valueOf(xxx)静态方法生成目标对象 ，如上面代码会调用 UniteId.valueOf(String value)方法</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/guide/forward.html" class="prev">
        转发
      </a></span> <span class="next"><a href="/guide/client.html">
        TODO CLIENT
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1513673d.js" defer></script><script src="/assets/js/2.6315147b.js" defer></script><script src="/assets/js/18.101806d3.js" defer></script>
  </body>
</html>
